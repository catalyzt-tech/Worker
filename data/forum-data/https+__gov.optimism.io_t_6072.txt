{
  "title": "Historical block hash as part of the L1Block contract",
  "content": "Hi guys, Z from LimeChain.\n\nTLDR\nOver the past 2 months we’ve encountered two use cases that are almost possible\nwith the Bedrock update but not quite - both related to the L1 block hash part\nof the L1Block contract. We think that solving this problem would be valuable\nfor the developer community. This post aims to outline two use-cases that call\nfor the existence of historical L1 block hash as part of the L1Block.\n\nUse case #1: Cross-rollup communication\nOne popular approach of the notoriously hard field of cross-rollup communication\noffers is proving that State X (represented in Storage A) has a certain value in\nanother rollup. This happens by proxy of the L1 state.\nFor any L1 Block where the source rollup has already anchored a certain value in\na storage slot, a prover can prove inside Optimism that the value exists and is\nexactly that.\nThe L1Block contract nicely offers the block hash of the latest L1 block and\nthis allows access to the state tree root. This is enough to run trustless\nMerkle-Patricia Trie (MPT) verification of the source rollup storage slot value.\nWhile in theory, this is correct, in practice any prover has just 15 seconds\ntime window to gather all the necessary information and submit OP transaction -\nin 15 seconds the block hash present in the L1Block will change and the MPT will\nno longer be correct.\nIf there was a historical mapping of L1 block number to block hash (both of\nthose are present in the L1Block at a certain time) the use-case would be\npractical as anyone can prove against any historical block.\n\nUse Case #2: Proving Transactions or Receipts\nIn somewhat similar vain to the cross rollup communication via storage slot\nproofs, we can find another use-case - proving that a certain transaction\nhappened inside L1, either by proving the transaction and its data, or its\nreceipt.\nWhile in use case #1, you can at least recalculate your MPT proof for the new\nblock hash, in this use-case once your targeted block hash is gone, you no\nlonger can trustlessly prove the transaction or the receipt. Remember that\nunlike storage that has “memory” passed in the next blocks, transactions and\nreceipts are only stored in their block and not the subsequent ones.\nThis makes these 15 seconds critical, and any infra failure unrecoverable.\n\nSolution A: The Ugly Workaround\nThe ugly solution one can create is “pinning” service. Every time the block hash\nupdates, an automated script sends OP transaction that reads and saves the L1\nblock hash in a mapping against its L1 block number.\nWhile this is a possible solution, this requires trust in the pinning service\nliveness, and has the potential for huge wast and somewhat unbounded costs.\n\nSolution B: The Neat Solution\nA neat solution would be for the historical block hashes to be part of the\nL1Block contract - they are already going through it. Instead of replacing them,\njust store them in a mapping.\n\nAny feedback is deeply appreciated. If this discussion garners popularity, the\nteam at LimeChain will be happy to contribute this to the OP stack.",
  "views": 3526,
  "like_count": 7,
  "word_count": 606,
  "answer": [
    {
      "content": "Hey @lee0007 [/u/lee0007], appreciate your input. We’ve went through the\nguidelines shared and think that a Mission Proposal would indeed be a good fit\nfor that, so we’ll probably explore it.",
      "created_at": "2023-06-12T07:26:23.043Z",
      "trust_level": 1,
      "username": "zhivkoto",
      "admin": false,
      "moderator": false,
      "staff": false,
      "like_count": 2
    },
    {
      "content": "Your proposal could align well with Collective Intent #1 Techincal\nDecentralisation\n\n\n[https://europe1.discourse-cdn.com/bc41dd/original/1X/391d6e71a279a9f881f75bfa7df5cdf3cf905b3f.png]\n[OLD] Collective Intents: Season 4\n[https://gov.optimism.io/t/collective-intents/5874] Delegates 🏛\n[/c/delegates/41]\n\n> Collective Intents Season 4 lays the groundwork to align the entire community\n> around Collective Intents. Intents are directional goals that allow the\n> Collective to align and focus. You can think of an Intent as a near term\n> target. There may be multiple paths towards that target; it is up to the\n> Collective to determine which paths to pursue by proposing Missions\n> [https://gov.optimism.io/t/token-house-missions/5881]. Most Season 4 Intents\n> will be set by the Foundation. Future Intents will incorporate more and more\n> input from the community, until the…\n\nAlso recommend checking out the info on Mission Proposals & Template\n\n\n[https://europe1.discourse-cdn.com/bc41dd/original/1X/391d6e71a279a9f881f75bfa7df5cdf3cf905b3f.png]\nToken House Missions [https://gov.optimism.io/t/token-house-missions/5881]\nARCHIVED & OLD Missions [/c/archived-old-missions/63]\n\n> Missions Season 4 aligns the entire community around Collective Intents\n> [https://gov.optimism.io/t/collective-intents/5874]. All work supported or\n> executed by the Collective should be in pursuit of our Collective Intents.\n> This is a simple concept, but it is distinct from the way work is supported\n> and executed in most DAOs. The Season 4 structure is designed very\n> intentionally, based on our research\n> [https://twitter.com/lalalavendr/status/1631349711956484097?cxt=HHwWgoDR2e7626MtAAAA],\n> to avoid some common challenges faced by other daos. These challenges usually\n> relate to a structure wherein working groups resembling persistent bus…\n\n\n[https://europe1.discourse-cdn.com/bc41dd/original/1X/391d6e71a279a9f881f75bfa7df5cdf3cf905b3f.png]\n[OLD] Proposed Mission Template\n[https://gov.optimism.io/t/proposed-mission-template/5882] Policies and\nTemplates 📌 [/c/policies-and-important-documents/49]\n\n> Mission Proposal Template We welcome feedback on the below proposal template\n> S4 Intent [https://gov.optimism.io/t/collective-intents/5874/2]: Proposed\n> Mission: Please include a one line description (tl;dr) Proposal Tier\n> [https://gov.optimism.io/t/collective-trust-tiers/5877/2]: Please verify that\n> you meet the qualifications for submitting at the above Tier: If an Alliance\n> is comprised of individual contributors tiers, the Tier at which that Alliance\n> may submit should be the Tier at which the Alliance Lead qualifies. Baseline\n> grant amount: % of total available Intent Budget: All Mission grants are…",
      "created_at": "2023-06-08T00:43:45.074Z",
      "trust_level": 2,
      "username": "lee0007",
      "admin": false,
      "moderator": false,
      "staff": false,
      "like_count": 1
    }
  ],
  "created_at": "2023-06-07T13:24:44.076Z"
}