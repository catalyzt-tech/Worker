{
  "title": "[FINAL] Protocol Upgrade #8: Guardian, Security Council Threshold and L2 ProxyAdmin Ownership changes for Stage 1 Decentralization",
  "content": "Hi Maurelian here, I’m a protocol security engineer at OP Labs. OP Labs is a\nsoftware development company focused on the Optimism ecosystem and a core\ndeveloper of the OP Stack. We provide some services to, but do not represent or\nspeak on behalf of, the Optimism Foundation.\n\n\nEXECUTIVE SUMMARY\n\nThe protocol upgrade is intended to increase the security and decentralization\nof the Superchain by meeting the following requirements:\n\n 1. Increasing the Security Council Safe’s signing threshold, from 4 to 10, out\n    of 13 owners. This meets the 75% threshold requirement for a Stage 1 rollup\n    outlined in L2Beat’s Stages framework\n    [https://medium.com/l2beat/stages-update-security-council-requirements-4c79cea8ef52].\n\n 2. Reassigning the role of Guardian from the Foundation to a new Guardian Safe\n    with the Security Council Safe as its sole owner. This moves the Superchain\n    closer to satisfying the 1 week exit window\n    [https://medium.com/l2beat/introducing-stages-a-framework-to-evaluate-rollups-maturity-d290bb22befe]\n    requirement for Stage 1.\n    \n    Additionally the Foundation is appointed to the new DeputyGuardian role\n    which is able to act as Guardian through the Guardian Safe. This appointment\n    can be revoked by the Security Council Safe at any time.\n    \n    Even though the appointment of the DeputyGuardian is closer to a change in\n    configuration than version, it is a fundamental component of the\n    Superchain’s security model and thus we are requesting governance approval\n    (as would, we believe, any decision to use the Security Council Safe to\n    modify the DeputyGuardian).\n    \n    Note that the Guardian role is generally authorized to enforce ‘Safety over\n    Liveness’ in the system, meaning that it can currently pause and unpause\n    withdrawals, and following the Fault Proofs upgrade will be able to\n    intervene in the event that a bug would allow an invalid L2 output to be\n    finalized.\n\n 3. Reassigning the owner of the L2ProxyAdmin contract from the Foundation to\n    the Security Council (currently in Phase 0, which is a joint 2/2 multisig\n    between the Security Councils Safe and the Foundation Safe). This ensures\n    the Security Council Safe has a blocking vote for L2 predeploy upgrades and\n    is a requirement for Stage 1.\n\nIf this vote passes, we recommend the upgrade be deployed shortly after the end\nof the veto period.\n\n\nSPECIFICATIONS\n\nThe full specifications for the Liveness Extension and Deputy Guardian system\nare available from the specs repo\n[https://specs.optimism.io/experimental/security-council-safe.html].\n\n\nTECHNICAL DETAILS\n\nThis upgrade does not affect the node or execution client software.\n\nThe following outlines the full set of changes to the existing system:\n\n 1. The SecurityCouncilSafe is modified to:\n    \n    1. Increase its threshold from 4 to 10. The current owner count is 13 and\n       will remain unchanged with this upgrade.\n    \n    2. Extend its functionality by enabling new LivenessModule\n       [https://github.com/ethereum-optimism/optimism/blob/op-contracts/v1.5.0-rc.1/packages/contracts-bedrock/src/Safe/LivenessModule.sol]\n       and LivenessGuard\n       [https://github.com/ethereum-optimism/optimism/blob/op-contracts/v1.5.0-rc.1/packages/contracts-bedrock/src/Safe/LivenessGuard.sol]\n       contracts.\n       \n       This module and guard comprise a liveness checking mechanism intended to\n       ensure that any loss of access to a signer’s keys is identified and\n       addressed within a predictable period of time.\n       \n       The maximum time during which an owner will be considered live without\n       having signed a transaction or else explicitly calling the guard to\n       demonstrate liveness, will be 3 months14 weeks. Should an owner not be\n       live during that time, the Module will enable that owner to be removed\n       without requiring a threshold of owners to sign. The duration of 14 weeks\n       is chosen to be slightly longer than 3 months, so that liveness can be\n       demonstrated on a regular quarterly cadence.\n       In the unlikely event that enough owners are removed to reduce the total\n       number of owners below 8, then the module will enable all owners to be\n       removed and be replaced with the Foundation as the sole owner.\n\n 2. A new GuardianSafe is deployed, which has a threshold of 1, and the Security\n    Council Safe as its only owner.\n    \n    A new DeputyGuardianModule\n    [https://github.com/ethereum-optimism/optimism/blob/op-contracts/v1.5.0-rc.1/packages/contracts-bedrock/src/Safe/DeputyGuardianModule.sol]\n    is enabled on this GuardianSafe. This module enables the FoundationSafe to\n    call any of the Guardian authorized actions in the SuperchainConfig and\n    OptimismPortal contracts.\n    \n    This architecture will allow the Foundation to maintain the fast incident\n    response system it has established, while providing the Security Council\n    Safe with the ultimate authority to:\n    \n    * override and reverse any Guardian actions taken by the Foundation.\n    * revoke the capacity to act as the Guardian by disabling the\n      DeputyGuardianModule.\n\n 3. The SuperchainConfig contract is upgraded with the GuardianSafe in the\n    Guardian role (the code is unchanged).\n\n 4. The L2ProxyAdminOwner is set to the aliased\n    [https://docs.optimism.io/chain/differences#address-aliasing] address of the\n    L1ProxyAdminOwner, which is the Phase 0 Security Council.\n    \n    The L1ProxyAdminOwner (i.e., the Phase 0 Security Council) can now send\n    bridging messages\n    [https://docs.optimism.io/builders/app-developers/bridging/messaging] from\n    L1 to L2 to upgrade predeploy contracts on L2. This ensures the Security\n    Council Safe has a blocking vote for L2 predeploy upgrades.\n    \n    The L2ProxyAdminOwner is changed by calling transferOwnership() on\n    L2ProxyAdmin with the aliased address of the L1ProxyAdmin.\n\nThese contracts are tagged in the optimism repo at commit 9047beb\n[https://github.com/ethereum-optimism/optimism/commit/9047beb54c66a5c572784efec8984f259302ec92]\n(tagged as release candidate op-contracts/v1.5.0-rc.1\n[https://github.com/ethereum-optimism/optimism/releases/tag/op-contracts%2Fv1.5.0-rc.1]).\n\n\nSECURITY CONSIDERATIONS\n\n\nCODE SECURITY\n\nConsistent with the OP Labs Audit Framework\n[https://gov.optimism.io/t/op-labs-audit-framework-when-to-get-external-security-review-and-how-to-prepare-for-it/6864],\nOP Labs had the code audited by a Cantina contest\n[https://cantina.xyz/competitions/d47f8096-8858-437d-a9f5-2fe85ac9b95e] which\nended on May 10th. A Lead Security Researcher from Spearbit was also engaged to\naudit the system in parallel.\n\nThis audit uncovered no High severity issues, however a number of improvements\nwere identified which we elected to make in order to reduce the potential for\nissues resulting from human error. A draft of the report can be viewed here\n[https://github.com/ethereum-optimism/optimism/blob/maur/cantina/docs/security-reviews/2024_05_SafeLivenessExtensions-Cantina.pdf].\nIt will be finalized after the completion of judging and escalation, however OP\nLabs has reviewed the findings with assistance from the Cantina/Spearbit team\nand are confident that no High severity issues were identified.\n\nThose changes (all in the LivenessModule) are:\n\n 1. A constructor check was removed, which enforced that the Safe’s threshold\n    was greater than 75% of the owner count at the time of the module’s\n    deployment. This check reduces the likelihood of the module being enabled on\n    a misconfigured Safe, but also made the deployment and upgrade process more\n    difficult. The check will instead be done at upgrade time, thus ensuring no\n    loss of safety (PR here\n    [https://github.com/ethereum-optimism/optimism/pull/10516]).\n 2. Error message handling was modified to be more consistent with other\n    portions of the codebase (PR here\n    [https://github.com/ethereum-optimism/optimism/pull/10538]).\n 3. The module will be deactivated in the event that ownership of the Security\n    Council Safe is transferred to the FALLBACK_OWNER (the Foundation Safe).\n    This mitigates the risk of unexpected behavior when the Safe is operating\n    below the expected minimum number of owners (PR here\n    [https://github.com/ethereum-optimism/optimism/pull/10529]).\n\n\nOPERATIONAL SECURITY\n\nWe will also establish monitoring systems for detecting events associated with\nthe code. These systems will detect and alert on the following events:\n\n 1. In the LivenessModule\n    \n    1. When a signer on the Security Council Safe is no longer live and can be\n       removed.\n    2. When a signer is added or removed.\n    3. When the fallback owner is activated.\n\n 2. On the Security Council Safe:\n    \n    1. When either the LivenessModule or LivenessGuard are removed or replaced.\n    2. When any other module or guard is added or removed.\n\n 3. On the DeputyGuardianModule:\n    \n    When any of the Guardian actions are taken using the module, including:\n    \n    1. Calling pause/unpause on the SuperchainConfig contract.\n    2. Calling blacklistDisputeGame, setRespectedGameType on an OptimismPortal\n       contract.\n\n\nPROXY ADMIN OWNER SECURITY\n\nAccording to the Stages framework\n[https://medium.com/l2beat/introducing-stages-a-framework-to-evaluate-rollups-maturity-d290bb22befe],\none of the requirements for Stage 1 is that “Users’ withdrawals cannot be\ncensored by the permissioned operators”. This means that any vector to halt or\ncensor users’ withdrawals OR steal users’ funds must be controlled by the\nSecurity Council.\n\nAn attack vector exists whereby the L2ProxyAdminOwner can potentially steal\nusers’ funds by upgrading L2 predeploy contracts. The specific attack is:\n\n * Upgrade the L2toL1MessagePasser contract,\n * Insert false entries to the [sentMessages()\n   mapping](https://github.com/ethereum-optimism/optimism/blob/maur/guardian-module/packages/contracts-bedrock/src/L2/L2ToL1MessagePasser.sol#L24\n   [https://github.com/ethereum-optimism/optimism/blob/maur/guardian-module/packages/contracts-bedrock/src/L2/L2ToL1MessagePasser.sol#L24]),\n   * One falsified withdrawal per asset is required to access the full balance\n     of each ERC20 (in the Bridge) or ETH (in the Portal)\n * Withdraw ERC20s from the Bridge and ETH from the Portal\n\nTo ensure “no permissioned operators” can censor users’ withdrawals or steal\nusers’ funds (and therefore satisfy Stage 1 requirements), the L2ProxyAdminOwner\nis being transferred from the Foundation Safe to the L2 alias\n[https://docs.optimism.io/chain/differences#address-aliasing] of the Phase 0\nSecurity Council. The Security Council Safe will now have a blocking vote on all\nL2 predeploy upgrades.\n\n\nIMPACT SUMMARY\n\nOP Labs does not anticipate any downtime due to this upgrade. Node operators are\nnot affected. Existing contracts retain their current interfaces in order to\nremain backward compatible with any existing integrations.\n\nThese changes primarily affect the system of ownership and authorization, and\nserve to increase the decentralization of the Superchain.\n\n\nACTION PLAN\n\nIf this proposal passes a Token House vote, the L1 contracts will be upgraded\nfollowing the completion of the Citizens’ House Veto Period following Voting\nCycle #23a. The upgrade will be completed atomically such that all affected L1\ncontracts will be upgraded within a single transaction.\n\nNo action is required by node operators, as this is change affects contracts\nonly.\n\nIf a critical security issue is discovered before upgrading, OP Labs will\ncollaborate with the community to extensively communicate that the upgrade will\nno longer occur.\n\n\nCONCLUSION\n\nThis upgrade moves the Superchain forward in terms of decentralization, while\npreserving existing incident response capabilities and providing safety against\npotential liveness failures.",
  "views": 1730,
  "like_count": 51,
  "word_count": 4639,
  "answer": [
    {
      "content": "On behalf of the Developer Advisory Board, here is a non-technical summary of\nthis upgrade proposal:\n\nThe Optimism team has proposed three important changes to enhance the security\nand decentralization of the network. This is a summary of these changes aimed to\nbe digestible by non-technical members of the Optimism Collective.\n\nAll of these changes are aimed at achieving a technical description of Stage 1\nDecentralization, which is a critical step towards decentralizing the OP stack.\nThese changes have the goal of increasing the security of the OP stack,\nimproving decentralization, and enabling strong incident response.\n\nThese changes have been audited by third party auditors in a Cantina contest\n[https://cantina.xyz/competitions/d47f8096-8858-437d-a9f5-2fe85ac9b95e] which\nended on May 10th. A Lead Security Researcher from Spearbit was also engaged to\naudit the system in parallel. The audits uncovered no High severity issues.\n\n1. Increase in Security Council Threshold:\n\n * Current State: Decisions require 4 out of 13 members to approve.\n * Proposed Change: Increase this to 10 out of 13 members.\n * Reason: This higher threshold ensures that more members must agree before any\n   decision is made, significantly improving the network’s security by reducing\n   the risk of a small group making unilateral decisions.\n\nThresholds: Threshold signatures are ways to ensure that some group of\nauthorized organizations or individuals have to agree before authorizing an\naction. For example Imagine you and your friends have a magical treasure chest.\nTo open it, you need a special key. But, instead of one person having the key,\nthe key is split into pieces. Each friend holds a piece of the key.\n\nTo open the chest, you need a certain number of friends (say 3 out of 5) to put\ntheir pieces together. This way, no single person can open the chest alone; it\nrequires teamwork. This makes sure the treasure is safe and only opened when\nenough friends agree. In general when the threshold is higher, this requires\nmore parties to agree on unlocking the chest.\n\nThe Security council makes decisions in a similar way to ensure one entity\ndoesn’t have the ability to make unilateral decisions. The chest in this\nscenario is a smart contract that authorizes actions. Right now the threshold is\nlow (only 4 out of 13 members need to put their key piece together) this upgrade\nincreases the security by requiring that 10 out of 13 key pieces are needed to\nauthorize upgrade changes. The increase in the security council threshold\nrequires that members of the security council need to agree before decisions are\nmade, which improves the network security by reducing the risk that a small\ngroup makes unilateral decisions. Notably this meets the 75% threshold\nrequirement for a Stage 1 rollup outlined in L2Beat’s Stages framework\n[https://medium.com/l2beat/stages-update-security-council-requirements-4c79cea8ef52]\nwhich is a respected framework for evaluating the stages of decentralization of\nrollups.\n\n2. Guardian Role Transfer:\n\n * Current State: The Foundation currently holds the Guardian role.\n * Proposed Change: Transfer this role to a new entity called the Guardian Safe,\n   which will be controlled by the Security Council.\n * The foundation will be appointed the Deputy Guardian Role, which has the\n   ability to act as a guardian through the Guardian Safe.\n\nThe Guardian Role is able to pause withdrawals from the OP stack in an\nunprecedented event in which there is a critical vulnerability in the fault\nproof system. Withdrawals are the act of withdrawing assets from an OP chain to\nEthereum mainnet. The fault proofs are meant to make this process\npermissionless. But in the scenario where an attacker could withdraw more than\nthey have (withdrawing other users’ funds from the OP Chain), the Guardian Role\ncan stop the attacker. This is considered a short term safeguard, but critical\nto ensure the safety of the Optimism ecosystem in the case of a catastrophic\nevent. In practice the Guardian Role is a smart contract that can only be called\nby an authorized wallet. This proposal sets the Security Councils threshold (as\ndescribed above) as the authorized Guardian. This change also delegates the\nGuardian capabilities to the foundation by assigning them the Deputy Guardian\nRole, allowing the foundation the same abilities as the Guardian Role (to pause\nwithdrawals). In practice this upgrade only changes the configuration of the\nGuardian such that the Optimism network can move closer to the stage 1\ndecentralization described by L2 Beat\n[https://medium.com/l2beat/introducing-stages-a-framework-to-evaluate-rollups-maturity-d290bb22befe].\n\n * Current State: The ownership of the L2ProxyAdmin contract is the Optimism\n   Foundation multisig.\n * Proposed Change: Reassign this ownership to a 2/2 threshold between the\n   Security Council and the Optimism Foundation.\n * Reason: By transferring the ownership to the Security Council, the control\n   over key administrative functions becomes more decentralized, preventing any\n   single entity from having too much control over the system’s critical\n   upgrades and changes.\n\nThis change ensures that the Security Council Safe has a blocking vote for L2\npre-deploy upgrades and is a requirement for Stage 1. This means that when a\nnetworking upgrade is being voted on, the security council can vote against a\nnetwork upgrade and prevent the vote from passing. This is important because not\nall upgrades are safe and if there is a network upgrade that is proposed that\nhas security vulnerabilities, the security council should be able to stop the\nproposal from passing.",
      "created_at": "2024-05-21T15:36:23.411Z",
      "trust_level": 2,
      "username": "Jepsen",
      "admin": false,
      "moderator": false,
      "staff": false,
      "like_count": 14
    },
    {
      "content": "As Security Council Lead, I am excited and proud to see this proposal to\nprogress the Security Council from Phase 0 to Phase 1. This is a huge step in\nfurther decentralizing the Superchain :clap:\n[https://emoji.discourse-cdn.com/twitter/clap.png?v=12] .\n\n\n[https://dub1.discourse-cdn.com/bc41dd/user_avatar/gov.optimism.io/maurelian/48/9353_2.png]\nmaurelian:\n\n> Increasing the Security Council Safe’s signing threshold, from 4 to 10, out of\n> 13 owners.\n\nThis is a significant change from the current signing threshold, which is 4/13.\nSigning data from the last two proposal upgrades signed by the Security Council\nis as follows:\n\n * 13/13 SC members submitted signatures for Proposal Upgrade 4; and\n * 12/13 SC members submitted signatures for Proposal Upgrade 6.\n\nBased on these numbers, I do not anticipate any issues with the Security Council\nmeeting the increased signing threshold (75%). During Phase 0, the Security\nCouncil was operating on the basis that it should be meeting a 75% signing\nthreshold, in anticipation of moving to Phase 1.\n\nI am confident in the ability of the individuals and entities who make up the OP\nSecurity Council to meet the new requirements and additional scope set out in\nthis proposal.\n\nIf anyone is interested in keeping up to date on the Security Council, monthly\nupdates are posted on opsc.vercel.app [https://opsc.vercel.app/].",
      "created_at": "2024-05-16T18:32:26.037Z",
      "trust_level": 2,
      "username": "alisha.eth",
      "admin": false,
      "moderator": false,
      "staff": false,
      "like_count": 6
    },
    {
      "content": "Check the recording link posted here, next to the end of the call they address\nthese questions:\n\n\n[https://dub1.discourse-cdn.com/bc41dd/user_avatar/gov.optimism.io/michael/48/2489_2.png]\nOptimism Community Call Recaps & Recordings Thread\n[https://gov.optimism.io/t/optimism-community-call-recaps-recordings-thread/6937/37]\nCommunity Calls [/c/updates-and-announcements/55-category/55]\n\n> Token House: May 14th, 2024 Recording: May 14, 2024 S6 AMA and Token House\n> Call.mp4 - Google Drive\n> [https://drive.google.com/file/d/1mAWfVMQkG0O_aWdPRtk5ojHuMXhsAgNg/view?usp=sharing]\n> Cycle 22 Final Grants Roundup\n> [https://gov.optimism.io/t/cycle-22-final-grants-roundup/8086] Total of 530\n> mission request applications and 130 finalists. The season is now closed and\n> new applications for season 6 will open on July 18th. Season 6 AMA\n> [https://gov.optimism.io/t/season-6-guide-to-season-6/8113] We are currently\n> in Season 6 Reflection Period: Reading Period. The reflection period will last\n> till June 26th, read Season 6: Reflection Period Guide\n> [https://gov.optimism.io/t/season-6-reflection-period-guide/8130] for all\n> dates and details. Season 6 will start on June…",
      "created_at": "2024-05-22T02:31:53.598Z",
      "trust_level": 4,
      "username": "Gonna.eth",
      "admin": false,
      "moderator": true,
      "staff": true,
      "like_count": 4
    },
    {
      "content": "I had to combine this document with the Fault Proofs post\n[https://gov.optimism.io/t/upgrade-proposal-fault-proofs/8161/9] to understand\nthe whole process and I feel there are a few gray areas.\n\n 1. Manual Verification Process: None of them specifically address the manual\n    verification process for the AnchorStateRegistry mentioned in the Fault\n    Proofs post. Clarifying who will conduct this verification and how it will\n    be carried out would provide a more complete picture.\n\n 2. Specific Actions of the Guardian: While both documents discuss the role of\n    the Guardian and its authority within the system, I can’t find examples of\n    specific actions that the Guardian might take in various scenarios like\n    dispute resolution, protocol upgrades or invalid output roots\n\n 3. Timeline and Coordination: Both documents outline the proposed actions and\n    upgrades, but are they going to be implemented as soon as the Token House\n    approves?\n\nSorry if this question has already been addressed. With all the S6 governance\ndocuments, I haven’t had the chance to give these documents the proper time.\nThank you for your patience.",
      "created_at": "2024-05-21T13:41:03.815Z",
      "trust_level": 4,
      "username": "Gonna.eth",
      "admin": false,
      "moderator": true,
      "staff": true,
      "like_count": 3
    },
    {
      "content": "I am concerned about the increase to 10/13 for SC multisig. Its better in terms\nof security to make upgrades but introduces new risks in terms of loss of keys\nor liveliness within a certain time frame to 4/13. It would also now require 4\nSC members to collude and stop upgrades/hold us ransom. I would prefer it to be\ncloser to 8/13 60% or 9/13 70%. It feels safer to me.\n\nAs for the other four upgrades, I feel are all understandable to implement.",
      "created_at": "2024-05-21T19:42:43.911Z",
      "trust_level": 2,
      "username": "Butterbum",
      "admin": false,
      "moderator": false,
      "staff": false,
      "like_count": 2
    }
  ],
  "created_at": "2024-05-16T17:00:45.343Z"
}